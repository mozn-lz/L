<%- include('./frame/header.ejs') %>
<%- include('./frame/menu.ejs') %>

<style>
	form {
		display: grid;
		place-items: center;
		padding-bottom: 30px;
	}
		
	.form-group {
		margin-bottom: 15px;
	}
		
	fieldset {
		padding-bottom: 20px;
	}
	label {
		padding: 3px;
	}
</style>
<div id="main">
	<h2 class="text-center">Register</h2>
	<div id="userboard"></div>
	<form id="registerForm">
		<div class="form-group">
			<label for="name">name</label>
			<input class="form-control" type="text" name="name" id="name" placeholder="name">
		</div>
		<div class="form-group">
			<label for="surname">surname</label>
			<input class="form-control" type="text" name="surname" id="surname" placeholder="surname">
		</div>
		<div class="form-group">
			<label for="cell_1">cell_1</label>
			<input class="form-control" type="text" name="cell1" id="cell1" placeholder="cell_1">
		</div>
		<div class="form-group">
			<label for="cell_2">cell_2</label>
			<input class="form-control" type="text" name="cell2" id="cell2" placeholder="cell_2">
		</div>
		<div class="form-group">
			<label for="email">email</label>
			<input class="form-control" type="email" name="email" id="email" placeholder="email">
		</div>
		<div class="form-group">
			<label for="password">password</label>
			<input class="form-control" type="password" name="password" id="password" placeholder="password">
		</div>
		<div class="form-group">
			<label for="confirmPassword">confirmPassword</label>
			<input class="form-control" type="password" name="confirmPassword" id="confirmPassword" placeholder="confirmPassword">
		</div>
		<input type="hidden" name="register" value="true">
		<button class="btn btn-primary">Register</button>
	</form>
</div>

<script>
	let user = {}
	let name = () => /^[a-zA-Z]{2,14}\w$/.test($('#name').val().trim());
	let surname = () => /^[a-zA-Z]{2,14}\w$/.test($('#surname').val().trim());
	let email = () => /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test($('#email').val().trim());
	let cell1 = () => /^[0-9]{4}[-\s\.]?[0-9]{4}$/im.test($('#cell1').val().trim());
	let cell2 = () => /^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test($('#cell2').val().trim());
	let password = () => /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})/.test($('#password').val());
	let password2 = () => $('#password').val() === $('#confirmPassword').val();

	$('#registerForm').submit((e) => {
		e.preventDefault();

		console.log('necpp', name(), email(), password(), password2());

		$.ajax({
			url: 'http://localhost:3000/users/',
			type: 'POST',
			data: $('#registerForm').serialize(),
			success: (result) => {
					console.log('successfully registered');
					const showMessage = $('#showMessage');
					if (result.success) {
							showMessage.html(`
								<div class="alert alert-success alert-dismissible fade show" role="alert">
									<div>Welcome...</div>
								</div>`);
								setTimeout(() => {
									$(location).attr('href', '/login');
								}, 2300);
					} else {
							let msg = '';
							result.msg ? msg = msg = result.msg : msg = 'Invalid credentials';
							showMessage.html(`
								<div class="alert alert-danger alert-dismissible fade show" role="alert">
									<div">${msg}</div>
								</div>`);
					}
					showMessage.show(2000);
					setTimeout(() => {
							showMessage.hide(2000);
					}, 5000);
			},
			error: (e) => { console.log('Error: ', e); }
		});
	});

	$('#name').keyup(() => { name() ? ($('#name').css('border', '#198754 solid 2px')) : ($('#name').css('border', '#dc3545 solid 2px')); });
	$('#surname').keyup(() => { surname() ? ($('#surname').css('border', '#198754 solid 2px')) : ($('#surname').css('border', '#dc3545 solid 2px')); });
	$('#password').keyup(() => { password() ? ($('#password').css('border', '#198754 solid 2px')) : ($('#password').css('border', '#dc3545 solid 2px')); });
	$('#confirmPassword').keyup(() => { password2() ? ($('#confirmPassword').css('border', '#198754 solid 2px')) : ($('#confirmPassword').css('border', '#dc3545 solid 2px')); });
	$('#email').keyup(() => { email() ? ($('#email').css('border', '#198754 solid 2px')) : ($('#email').css('border', '#dc3545 solid 2px')); });
	$('#cell1').keyup(() => { cell1() ? ($('#cell1').css('border', '#198754 solid 2px')) : ($('#cell1').css('border', '#dc3545 solid 2px')); });
	$('#cell2').keyup(() => { cell2() ? ($('#cell2').css('border', '#198754 solid 2px')) : ($('#cell2').css('border', '#dc3545 solid 2px')); });


</script>
<%- include('./frame/footer.ejs') %>